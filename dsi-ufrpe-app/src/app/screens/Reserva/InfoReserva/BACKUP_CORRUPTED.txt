import { Ionicons } from "@expo/vector-icons";import { Ionicons } from "@expo/vector-icons";import { ErrorState } from '@/src/components/ErrorState';

import { useFocusEffect, useLocalSearchParams, useRouter } from "expo-router";

import React, { useCallback, useState } from 'react';import { useFocusEffect, useLocalSearchParams, useRouter } from "expo-router";import { Loading } from '@/src/components/Loading';

import { Alert, ScrollView, StyleSheet, Text, TouchableOpacity, View, ActivityIndicator } from "react-native";

import { buscarReservaPorId, excluirReserva, realizarCheckin, realizarCheckout } from '@/src/services/reservasService';import React, { useCallback, useState } from 'react';import { ReservationService } from '@/src/services/ReservationService';

import type { Reserva } from '@/src/services/reservasService';

import { Alert, ScrollView, StyleSheet, Text, TouchableOpacity, View, ActivityIndicator } from "react-native";import { Reservation } from '@/src/types/reservation';

export default function InfoReserva() {

    const router = useRouter();import { buscarReservaPorId, excluirReserva, realizarCheckin, realizarCheckout } from '@/src/services/reservasService';import { formatCurrency, formatDate, withPlaceholder } from '@/src/utils/formatters';

    const { id } = useLocalSearchParams<{ id: string }>();

import type { Reserva } from '@/src/services/reservasService';import { Ionicons } from '@expo/vector-icons';

    const [reserva, setReserva] = useState<Reserva | null>(null);

    const [loading, setLoading] = useState(true);import { useFocusEffect, useLocalSearchParams, useRouter } from 'expo-router';

    const [processando, setProcessando] = useState(false);

export default function InfoReserva() {import React, { useCallback, useState } from 'react';

    const carregarReserva = useCallback(async () => {

        if (!id) {    const router = useRouter();import { Alert, ScrollView, StyleSheet, Text, TouchableOpacity, View } from 'react-native';

            Alert.alert('Erro', 'ID da reserva não fornecido');

            router.back();    const { id } = useLocalSearchParams<{ id: string }>();

            return;

        }    const [reserva, setReserva] = useState<Reserva | null>(null);const InfoReserva: React.FC = () => {



        try {    const [loading, setLoading] = useState(true);    const router = useRouter();

            setLoading(true);

            const data = await buscarReservaPorId(id);    const [processando, setProcessando] = useState(false);    const { id } = useLocalSearchParams<{ id: string }>();

            

            if (!data) {

                Alert.alert('Erro', 'Reserva não encontrada');

                router.back();    const carregarReserva = useCallback(async () => {    // Estados

                return;

            }        if (!id) {    const [reserva, setReserva] = useState<Reservation | null>(null);



            setReserva(data);            Alert.alert('Erro', 'ID da reserva não fornecido');    const [loading, setLoading] = useState(true);

        } catch (error) {

            console.error('Erro ao carregar reserva:', error);            router.back();    const [error, setError] = useState<string | null>(null);

            Alert.alert('Erro', 'Não foi possível carregar os dados da reserva');

        } finally {            return;

            setLoading(false);

        }        }    /**

    }, [id, router]);

        try {     * ✅ REQUISITO 1: Carregamento dos dados usando ID da URL

    useFocusEffect(

        useCallback(() => {            setLoading(true);     * ✅ REQUISITO 6: Atualização automática após retornar da edição (useFocusEffect)

            carregarReserva();

        }, [carregarReserva])            const data = await buscarReservaPorId(id);     */

    );

            if (!data) {    const loadReserva = useCallback(async () => {

    const handleCheckin = async () => {

        try {                Alert.alert('Erro', 'Reserva não encontrada');        if (!id) {

            setProcessando(true);

            await realizarCheckin(id);                router.back();            setError('ID da reserva não fornecido');

            Alert.alert('Sucesso', 'Check-in realizado com sucesso!');

            carregarReserva();                return;            setLoading(false);

        } catch (error) {

            console.error('Erro ao realizar check-in:', error);            }            return;

            Alert.alert('Erro', 'Não foi possível realizar o check-in');

        } finally {            setReserva(data);        }

            setProcessando(false);

        }        } catch (error) {

    };

            console.error('Erro ao carregar reserva:', error);        setLoading(true);

    const handleCheckout = async () => {

        try {            Alert.alert('Erro', 'Não foi possível carregar os dados da reserva');        setError(null);

            setProcessando(true);

            await realizarCheckout(id);        } finally {

            Alert.alert('Sucesso', 'Check-out realizado com sucesso!');

            carregarReserva();            setLoading(false);        const data = await ReservationService.getById(id);

        } catch (error) {

            console.error('Erro ao realizar check-out:', error);        }

            Alert.alert('Erro', 'Não foi possível realizar o check-out');

        } finally {    }, [id, router]);        if (!data) {

            setProcessando(false);

        }            setError('Reserva não encontrada');

    };

    useFocusEffect(useCallback(() => { carregarReserva(); }, [carregarReserva]));            setLoading(false);

    const handleExcluir = () => {

        Alert.alert(            return;

            "Confirmar Exclusão",

            "Tem certeza que deseja excluir esta reserva? Esta ação não pode ser desfeita.",    const handleCheckin = async () => {        }

            [

                {        try {

                    text: "Cancelar",

                    style: "cancel"            setProcessando(true);        setReserva(data);

                },

                {            await realizarCheckin(id);        setLoading(false);

                    text: "Excluir",

                    style: "destructive",            Alert.alert('Sucesso', 'Check-in realizado com sucesso!');    }, [id]);

                    onPress: async () => {

                        try {            carregarReserva();

                            await excluirReserva(id);

                            Alert.alert('Sucesso', 'Reserva excluída com sucesso!', [        } catch (error) {    // Recarrega os dados sempre que a tela receber foco

                                { text: 'OK', onPress: () => router.push("/screens/Reserva/ListagemReserva") }

                            ]);            console.error('Erro ao realizar check-in:', error);    useFocusEffect(

                        } catch (error) {

                            console.error('Erro ao excluir reserva:', error);            Alert.alert('Erro', 'Não foi possível realizar o check-in');        useCallback(() => {

                            Alert.alert('Erro', 'Não foi possível excluir a reserva');

                        }        } finally {            loadReserva();

                    }

                }            setProcessando(false);        }, [loadReserva])

            ]

        );        }    );

    };

    };

    if (loading) {

        return (    /**

            <View style={styles.container}>

                <View style={styles.header}>    const handleCheckout = async () => {     * ✅ REQUISITO 5: Modal de confirmação antes de excluir

                    <TouchableOpacity onPress={() => router.back()} style={styles.backButton}>

                        <Ionicons name="chevron-back" size={24} color="#FFFFFF" />        try {     */

                    </TouchableOpacity>

                    <View style={styles.breadcrumb}>            setProcessando(true);    const handleDelete = () => {

                        <Text style={styles.breadcrumbText}>Reservas</Text>

                        <Ionicons name="chevron-forward" size={16} color="#E0F2FE" />            await realizarCheckout(id);        Alert.alert(

                        <Text style={styles.breadcrumbTextActive}>Detalhes</Text>

                    </View>            Alert.alert('Sucesso', 'Check-out realizado com sucesso!');            "Confirmar Exclusão",

                </View>

                <View style={styles.loadingContainer}>            carregarReserva();            "Tem certeza que deseja excluir esta reserva? Esta ação não pode ser desfeita.",

                    <ActivityIndicator size="large" color="#0162B3" />

                    <Text style={styles.loadingText}>Carregando...</Text>        } catch (error) {            [

                </View>

            </View>            console.error('Erro ao realizar check-out:', error);                {

        );

    }            Alert.alert('Erro', 'Não foi possível realizar o check-out');                    text: "Cancelar",



    if (!reserva) {        } finally {                    style: "cancel"

        return (

            <View style={styles.container}>            setProcessando(false);                },

                <View style={styles.header}>

                    <TouchableOpacity onPress={() => router.back()} style={styles.backButton}>        }                {

                        <Ionicons name="chevron-back" size={24} color="#FFFFFF" />

                    </TouchableOpacity>    };                    text: "Excluir",

                    <View style={styles.breadcrumb}>

                        <Text style={styles.breadcrumbText}>Reservas</Text>                    style: "destructive",

                        <Ionicons name="chevron-forward" size={16} color="#E0F2FE" />

                        <Text style={styles.breadcrumbTextActive}>Detalhes</Text>    const handleExcluir = () => {                    onPress: async () => {

                    </View>

                </View>        Alert.alert("Confirmar Exclusão", "Tem certeza que deseja excluir esta reserva?", [                        const success = await ReservationService.delete(id);

                <View style={styles.errorContainer}>

                    <Ionicons name="alert-circle-outline" size={64} color="#DC2626" />            { text: "Cancelar", style: "cancel" },

                    <Text style={styles.errorText}>Reserva não encontrada</Text>

                </View>            {                        if (success) {

            </View>

        );                text: "Excluir", style: "destructive",                            Alert.alert(

    }

                onPress: async () => {                                "Sucesso",

    const formatarData = (data: string) => {

        if (!data) return '-';                    try {                                "Reserva excluída com sucesso!",

        try {

            const d = new Date(data);                        await excluirReserva(id);                                [

            return d.toLocaleDateString('pt-BR');

        } catch {                        Alert.alert('Sucesso', 'Reserva excluída com sucesso!', [                                    {

            return data;

        }                            { text: 'OK', onPress: () => router.push("/screens/Reserva/ListagemReserva") }                                        text: "OK",

    };

                        ]);                                        onPress: () => router.push("/screens/Reserva/ListagemReserva")

    const formatarValor = (valor: number) => {

        return valor.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });                    } catch (error) {                                    }

    };

                        console.error('Erro ao excluir reserva:', error);                                ]

    return (

        <View style={styles.container}>                        Alert.alert('Erro', 'Não foi possível excluir a reserva');                            );

            <View style={styles.header}>

                <TouchableOpacity onPress={() => router.back()} style={styles.backButton}>                    }                        } else {

                    <Ionicons name="chevron-back" size={24} color="#FFFFFF" />

                </TouchableOpacity>                }                            Alert.alert(

                <View style={styles.breadcrumb}>

                    <Text style={styles.breadcrumbText}>Reservas</Text>            }                                "Erro",

                    <Ionicons name="chevron-forward" size={16} color="#E0F2FE" />

                    <Text style={styles.breadcrumbTextActive}>Detalhes</Text>        ]);                                "Não foi possível excluir a reserva. Tente novamente."

                </View>

            </View>    };                            );



            <ScrollView style={styles.content}>                        }

                <View style={styles.card}>

                    <View style={styles.cardHeader}>    if (loading) {                    }

                        <Ionicons name="information-circle" size={24} color="#0162B3" />

                        <Text style={styles.cardTitle}>Informações da Reserva</Text>        return (                }

                    </View>

            <View style={styles.container}>            ]

                    <View style={styles.infoRow}>

                        <Text style={styles.label}>Status:</Text>                <View style={styles.header}>        );

                        <View style={[styles.statusBadge, styles[`status${reserva.status}`]]}>

                            <Text style={styles.statusText}>{reserva.status}</Text>                    <TouchableOpacity onPress={() => router.back()} style={styles.backButton}>    };

                        </View>

                    </View>                        <Ionicons name="chevron-back" size={24} color="#FFFFFF" />



                    <View style={styles.infoRow}>                    </TouchableOpacity>    /**

                        <Text style={styles.label}>Check-in:</Text>

                        <Text style={styles.value}>{formatarData(reserva.data_checkin)}</Text>                    <View style={styles.breadcrumb}>     * ✅ REQUISITO 2: Exibição de loading durante busca

                    </View>

                        <Text style={styles.breadcrumbText}>Reservas</Text>     */

                    <View style={styles.infoRow}>

                        <Text style={styles.label}>Check-out:</Text>                        <Ionicons name="chevron-forward" size={16} color="#E0F2FE" />    if (loading) {

                        <Text style={styles.value}>{formatarData(reserva.data_checkout)}</Text>

                    </View>                        <Text style={styles.breadcrumbTextActive}>Detalhes</Text>        return (



                    <View style={styles.infoRow}>                    </View>            <View style={styles.container}>

                        <Text style={styles.label}>Valor Total:</Text>

                        <Text style={styles.valueHighlight}>{formatarValor(reserva.valor_total)}</Text>                </View>                <View style={styles.header}>

                    </View>

                <View style={styles.subContainer}>                    <TouchableOpacity onPress={() => router.push("/screens/Reserva/ListagemReserva")} style={styles.backButton}>

                    <View style={styles.infoRow}>

                        <Text style={styles.label}>Observações:</Text>                    <ActivityIndicator size="large" color="#0162B3" />                        <Ionicons name="chevron-back" size={24} color="#FFFFFF" />

                        <Text style={styles.value}>{reserva.observacoes || '-'}</Text>

                    </View>                    <Text style={styles.loadingText}>Carregando reserva...</Text>                    </TouchableOpacity>

                </View>

                </View>                    <View style={styles.breadcrumb}>

                <View style={styles.actionsCard}>

                    <Text style={styles.actionsSectionTitle}>Ações</Text>            </View>                        <Text style={styles.breadcrumbText}>Reservas</Text>



                    {reserva.status === 'confirmada' && (        );                        <Ionicons name="chevron-forward" size={16} color="#E0F2FE" />

                        <TouchableOpacity

                            style={[styles.actionButton, styles.checkinButton]}    }                        <Text style={styles.breadcrumbTextActive}>Detalhes</Text>

                            onPress={handleCheckin}

                            disabled={processando}                    </View>

                        >

                            {processando ? (    if (!reserva) return <View style={styles.container}><Text>Reserva não encontrada</Text></View>;                </View>

                                <ActivityIndicator size="small" color="#FFFFFF" />

                            ) : (                <View style={styles.subContainer}>

                                <>

                                    <Ionicons name="log-in-outline" size={20} color="#FFFFFF" />    const clienteNome = reserva.clientes?.nome_completo || 'Cliente não informado';                    <Loading message="Carregando reserva..." />

                                    <Text style={styles.actionButtonText}>Realizar Check-in</Text>

                                </>    const quartoNumero = reserva.quartos?.numero_quarto || 'Quarto não informado';                </View>

                            )}

                        </TouchableOpacity>    const statusColor = reserva.status === 'confirmada' ? '#10B981' : reserva.status === 'cancelada' ? '#EF4444' : '#64748B';            </View>

                    )}

        );

                    {reserva.status === 'checkin_realizado' && (

                        <TouchableOpacity    return (    }

                            style={[styles.actionButton, styles.checkoutButton]}

                            onPress={handleCheckout}        <View style={styles.container}>

                            disabled={processando}

                        >            <View style={styles.header}>    /**

                            {processando ? (

                                <ActivityIndicator size="small" color="#FFFFFF" />                <TouchableOpacity onPress={() => router.push("/screens/Reserva/ListagemReserva")} style={styles.backButton}>     * ✅ REQUISITO 3: Mensagem de erro amigável se não encontrada

                            ) : (

                                <>                    <Ionicons name="chevron-back" size={24} color="#FFFFFF" />     */

                                    <Ionicons name="log-out-outline" size={20} color="#FFFFFF" />

                                    <Text style={styles.actionButtonText}>Realizar Check-out</Text>                </TouchableOpacity>    if (error || !reserva) {

                                </>

                            )}                <View style={styles.breadcrumb}>        return (

                        </TouchableOpacity>

                    )}                    <Text style={styles.breadcrumbText}>Reservas</Text>            <View style={styles.container}>



                    <TouchableOpacity                    <Ionicons name="chevron-forward" size={16} color="#E0F2FE" />                <View style={styles.header}>

                        style={[styles.actionButton, styles.editButton]}

                        onPress={() => router.push(`/screens/Reserva/EdicaoReserva?id=${id}`)}                    <Text style={styles.breadcrumbTextActive}>Detalhes</Text>                    <TouchableOpacity onPress={() => router.back()} style={styles.backButton}>

                    >

                        <Ionicons name="create-outline" size={20} color="#FFFFFF" />                </View>                        <Ionicons name="chevron-back" size={24} color="#FFFFFF" />

                        <Text style={styles.actionButtonText}>Editar Reserva</Text>

                    </TouchableOpacity>            </View>                    </TouchableOpacity>



                    <TouchableOpacity                    <View style={styles.breadcrumb}>

                        style={[styles.actionButton, styles.deleteButton]}

                        onPress={handleExcluir}            <View style={styles.profileSection}>                        <Text style={styles.breadcrumbText}>Reservas</Text>

                    >

                        <Ionicons name="trash-outline" size={20} color="#FFFFFF" />                <View style={styles.profileImagePlaceholder}>                        <Ionicons name="chevron-forward" size={16} color="#E0F2FE" />

                        <Text style={styles.actionButtonText}>Excluir Reserva</Text>

                    </TouchableOpacity>                    <Ionicons name="calendar" size={50} color="#FFFFFF" />                        <Text style={styles.breadcrumbTextActive}>Detalhes</Text>

                </View>

            </ScrollView>                </View>                    </View>

        </View>

    );                <Text style={styles.profileName}>Reserva #{reserva.id}</Text>                </View>

}

                <Text style={styles.profileSubtitle}>{clienteNome}</Text>                <View style={styles.subContainer}>

const styles = StyleSheet.create({

    container: {            </View>                    <ErrorState

        flex: 1,

        backgroundColor: '#132F3B',                        message={error || 'Reserva não encontrada'}

    },

    header: {            <View style={styles.subContainer}>                        onRetry={loadReserva}

        flexDirection: 'row',

        alignItems: 'center',                <View style={styles.titleContainer}>                        onGoBack={() => router.push("/screens/Reserva/ListagemReserva")}

        paddingTop: 50,

        paddingBottom: 20,                    <Text style={styles.title}>Detalhes da Reserva</Text>                    />

        paddingHorizontal: 16,

    },                </View>                </View>

    backButton: {

        marginRight: 16,                <View style={styles.separator} />            </View>

    },

    breadcrumb: {                <ScrollView style={styles.scrollContent} showsVerticalScrollIndicator={false}>        );

        flexDirection: 'row',

        alignItems: 'center',                    <View style={styles.infoRow}>    }

        gap: 8,

    },                        <Ionicons name="person-outline" size={20} color="#0162B3" />

    breadcrumbText: {

        fontSize: 14,                        <View style={styles.infoTextContainer}>    // Mapear cores do status

        color: '#E0F2FE',

    },                            <Text style={styles.infoLabel}>CLIENTE</Text>    const getStatusColor = (status: string) => {

    breadcrumbTextActive: {

        fontSize: 14,                            <Text style={styles.infoValue}>{clienteNome}</Text>        switch (status) {

        color: '#FFFFFF',

        fontWeight: '600',                        </View>            case 'Confirmada': return '#FFE157';

    },

    loadingContainer: {                    </View>            case 'Ativa': return '#10B981';

        flex: 1,

        alignItems: 'center',                    <View style={styles.infoRow}>            case 'Finalizada': return '#6B7280';

        justifyContent: 'center',

        backgroundColor: '#FFFFFF',                        <Ionicons name="bed-outline" size={20} color="#0162B3" />            case 'Cancelada': return '#EF4444';

        borderTopLeftRadius: 20,

        borderTopRightRadius: 20,                        <View style={styles.infoTextContainer}>            default: return '#6B7280';

    },

    loadingText: {                            <Text style={styles.infoLabel}>QUARTO</Text>        }

        marginTop: 12,

        fontSize: 16,                            <Text style={styles.infoValue}>{quartoNumero} - {reserva.quartos?.tipo}</Text>    };

        color: '#64748B',

    },                        </View>

    errorContainer: {

        flex: 1,                    </View>    return (

        alignItems: 'center',

        justifyContent: 'center',                    <View style={styles.infoRow}>        <View style={styles.container}>

        backgroundColor: '#FFFFFF',

        borderTopLeftRadius: 20,                        <Ionicons name="log-in-outline" size={20} color="#0162B3" />            {/* ✅ REQUISITO 9: Breadcrumb/indicador de navegação */}

        borderTopRightRadius: 20,

        padding: 20,                        <View style={styles.infoTextContainer}>            <View style={styles.header}>

    },

    errorText: {                            <Text style={styles.infoLabel}>CHECK-IN</Text>                <TouchableOpacity onPress={() => router.push("/screens/Reserva/ListagemReserva")} style={styles.backButton}>

        marginTop: 16,

        fontSize: 18,                            <Text style={styles.infoValue}>{reserva.data_checkin || 'Não informado'}</Text>                    <Ionicons name="chevron-back" size={24} color="#FFFFFF" />

        color: '#DC2626',

        fontWeight: '600',                        </View>                </TouchableOpacity>

    },

    content: {                    </View>                <View style={styles.breadcrumb}>

        flex: 1,

        backgroundColor: '#FFFFFF',                    <View style={styles.infoRow}>                    <Text style={styles.breadcrumbText}>Reservas</Text>

        borderTopLeftRadius: 20,

        borderTopRightRadius: 20,                        <Ionicons name="log-out-outline" size={20} color="#0162B3" />                    <Ionicons name="chevron-forward" size={16} color="#E0F2FE" />

    },

    card: {                        <View style={styles.infoTextContainer}>                    <Text style={styles.breadcrumbTextActive}>Detalhes</Text>

        margin: 16,

        padding: 16,                            <Text style={styles.infoLabel}>CHECK-OUT</Text>                </View>

        backgroundColor: '#F8FAFC',

        borderRadius: 12,                            <Text style={styles.infoValue}>{reserva.data_checkout || 'Não informado'}</Text>            </View>

        borderWidth: 1,

        borderColor: '#E2E8F0',                        </View>

    },

    cardHeader: {                    </View>            {/* Container branco com informações */}

        flexDirection: 'row',

        alignItems: 'center',                    <View style={styles.infoRow}>            <View style={styles.subContainer}>

        marginBottom: 16,

        gap: 8,                        <Ionicons name="cash-outline" size={20} color="#0162B3" />                <ScrollView style={styles.scrollContent} showsVerticalScrollIndicator={false}>

    },

    cardTitle: {                        <View style={styles.infoTextContainer}>                    {/* Título da reserva com badge de status */}

        fontSize: 18,

        fontWeight: '600',                            <Text style={styles.infoLabel}>VALOR TOTAL</Text>                    <View style={styles.reservaTitleContainer}>

        color: '#1E293B',

    },                            <Text style={styles.infoValue}>R$ {reserva.valor_total?.toFixed(2) || '0.00'}</Text>                        <View style={styles.titleRow}>

    infoRow: {

        flexDirection: 'row',                        </View>                            {/* ✅ REQUISITO 7 e 8: Formatação e tratamento de valores vazios */}

        justifyContent: 'space-between',

        alignItems: 'center',                    </View>                            <Text style={styles.reservaTitle}>

        paddingVertical: 12,

        borderBottomWidth: 1,                    <View style={styles.infoRow}>                                Reserva {withPlaceholder(reserva.id, 'S/N')}

        borderBottomColor: '#E2E8F0',

    },                        <Ionicons name="information-circle-outline" size={20} color="#0162B3" />                            </Text>

    label: {

        fontSize: 14,                        <View style={styles.infoTextContainer}>                            <View style={[

        color: '#64748B',

        fontWeight: '500',                            <Text style={styles.infoLabel}>STATUS</Text>                                styles.statusBadge,

    },

    value: {                            <Text style={[styles.infoValue, { color: statusColor }]}>                                { backgroundColor: getStatusColor(reserva.status) }

        fontSize: 14,

        color: '#1E293B',                                {reserva.status || 'Não informado'}                            ]}>

        fontWeight: '600',

    },                            </Text>                                <Text style={styles.statusText}>{reserva.status}</Text>

    valueHighlight: {

        fontSize: 16,                        </View>                            </View>

        color: '#0162B3',

        fontWeight: '700',                    </View>                        </View>

    },

    statusBadge: {                    {reserva.checkin_realizado_em && (                        <Text style={styles.reservaSubtitle}>Número da reserva</Text>

        paddingHorizontal: 12,

        paddingVertical: 4,                        <View style={styles.infoRow}>

        borderRadius: 12,

    },                            <Ionicons name="checkmark-circle-outline" size={20} color="#10B981" />                        {/* Linha divisória entre título e informações */}

    statusconfirmada: {

        backgroundColor: '#DBEAFE',                            <View style={styles.infoTextContainer}>                        <View style={styles.titleSeparator} />

    },

    statuscheckin_realizado: {                                <Text style={styles.infoLabel}>CHECK-IN REALIZADO</Text>                    </View>

        backgroundColor: '#D1FAE5',

    },                                <Text style={styles.infoValue}>{new Date(reserva.checkin_realizado_em).toLocaleString('pt-BR')}</Text>

    statuscheckout_realizado: {

        backgroundColor: '#E0E7FF',                            </View>                    {/* ✅ REQUISITO 7 e 8: Informações formatadas com placeholders */}

    },

    statuscancelada: {                        </View>                    <View style={styles.infoRow}>

        backgroundColor: '#FEE2E2',

    },                    )}                        <Ionicons name="calendar-outline" size={20} color="#0162B3" />

    statusText: {

        fontSize: 12,                    {reserva.checkout_realizado_em && (                        <View style={styles.infoTextContainer}>

        fontWeight: '600',

        color: '#1E293B',                        <View style={styles.infoRow}>                            <Text style={styles.infoLabel}>DATA DE CHECK-IN</Text>

        textTransform: 'capitalize',

    },                            <Ionicons name="checkmark-circle-outline" size={20} color="#10B981" />                            <Text style={styles.infoValue}>{formatDate(reserva.check_in_date)}</Text>

    actionsCard: {

        margin: 16,                            <View style={styles.infoTextContainer}>                        </View>

        marginTop: 0,

        padding: 16,                                <Text style={styles.infoLabel}>CHECK-OUT REALIZADO</Text>                    </View>

        backgroundColor: '#F8FAFC',

        borderRadius: 12,                                <Text style={styles.infoValue}>{new Date(reserva.checkout_realizado_em).toLocaleString('pt-BR')}</Text>

        borderWidth: 1,

        borderColor: '#E2E8F0',                            </View>                    <View style={styles.infoRow}>

    },

    actionsSectionTitle: {                        </View>                        <Ionicons name="calendar-outline" size={20} color="#0162B3" />

        fontSize: 16,

        fontWeight: '600',                    )}                        <View style={styles.infoTextContainer}>

        color: '#1E293B',

        marginBottom: 12,                </ScrollView>                            <Text style={styles.infoLabel}>DATA DE CHECK-OUT</Text>

    },

    actionButton: {                            <Text style={styles.infoValue}>{formatDate(reserva.check_out_date)}</Text>

        flexDirection: 'row',

        alignItems: 'center',                <View style={styles.separator} />                        </View>

        justifyContent: 'center',

        paddingVertical: 12,                <View style={styles.options}>                    </View>

        paddingHorizontal: 16,

        borderRadius: 8,                    {!reserva.checkin_realizado_em && (

        marginBottom: 12,

        gap: 8,                        <TouchableOpacity                    <View style={styles.infoRow}>

    },

    checkinButton: {                            style={[styles.buttonSuccess, processando && styles.buttonDisabled]}                        <Ionicons name="bed-outline" size={20} color="#0162B3" />

        backgroundColor: '#10B981',

    },                            onPress={handleCheckin}                        <View style={styles.infoTextContainer}>

    checkoutButton: {

        backgroundColor: '#6366F1',                            disabled={processando}                            <Text style={styles.infoLabel}>QUARTO</Text>

    },

    editButton: {                        >                            <Text style={styles.infoValue}>

        backgroundColor: '#0162B3',

    },                            <Ionicons name="log-in-outline" size={20} color="#FFFFFF" style={styles.buttonIcon} />                                {withPlaceholder(reserva.room_id, 'Não informado')}

    deleteButton: {

        backgroundColor: '#DC2626',                            <Text style={styles.buttonSuccessText}>Realizar Check-in</Text>                            </Text>

    },

    actionButtonText: {                        </TouchableOpacity>                        </View>

        color: '#FFFFFF',

        fontSize: 14,                    )}                    </View>

        fontWeight: '600',

    },                    {reserva.checkin_realizado_em && !reserva.checkout_realizado_em && (

});

                        <TouchableOpacity                    <View style={styles.infoRow}>

                            style={[styles.buttonWarning, processando && styles.buttonDisabled]}                        <Ionicons name="cash-outline" size={20} color="#0162B3" />

                            onPress={handleCheckout}                        <View style={styles.infoTextContainer}>

                            disabled={processando}                            <Text style={styles.infoLabel}>VALOR TOTAL</Text>

                        >                            <Text style={styles.infoValue}>{formatCurrency(reserva.total_amount)}</Text>

                            <Ionicons name="log-out-outline" size={20} color="#FFFFFF" style={styles.buttonIcon} />                        </View>

                            <Text style={styles.buttonWarningText}>Realizar Check-out</Text>                    </View>

                        </TouchableOpacity>

                    )}                    {reserva.pending_amount > 0 && (

                    <TouchableOpacity                        <View style={styles.infoRow}>

                        style={styles.buttonPrimary}                            <Ionicons name="alert-circle-outline" size={20} color="#F59E0B" />

                        onPress={() => router.push({ pathname: "/screens/Reserva/EdicaoReserva", params: { id: reserva.id } })}                            <View style={styles.infoTextContainer}>

                    >                                <Text style={styles.infoLabel}>VALOR PENDENTE</Text>

                        <Ionicons name="create-outline" size={20} color="#FFFFFF" style={styles.buttonIcon} />                                <Text style={[styles.infoValue, { color: '#F59E0B' }]}>

                        <Text style={styles.buttonPrimaryText}>Editar Reserva</Text>                                    {formatCurrency(reserva.pending_amount)}

                    </TouchableOpacity>                                </Text>

                    <TouchableOpacity style={styles.buttonDanger} onPress={handleExcluir}>                            </View>

                        <Ionicons name="trash-outline" size={20} color="#EF4444" style={styles.buttonIcon} />                        </View>

                        <Text style={styles.buttonDangerText}>Excluir</Text>                    )}

                    </TouchableOpacity>

                </View>                    {reserva.actual_check_in && (

            </View>                        <View style={styles.infoRow}>

        </View>                            <Ionicons name="checkmark-circle-outline" size={20} color="#10B981" />

    )                            <View style={styles.infoTextContainer}>

}                                <Text style={styles.infoLabel}>CHECK-IN REALIZADO</Text>

                                <Text style={styles.infoValue}>{formatDate(reserva.actual_check_in)}</Text>

const styles = StyleSheet.create({                            </View>

    container: { flex: 1, backgroundColor: '#132F3B' },                        </View>

    header: { flexDirection: 'row', alignItems: 'center', paddingTop: 50, paddingBottom: 16, paddingHorizontal: 16, backgroundColor: '#132F3B' },                    )}

    backButton: { marginRight: 16 },

    breadcrumb: { flexDirection: 'row', alignItems: 'center', gap: 8, flex: 1 },                    {reserva.actual_check_out && (

    breadcrumbText: { fontSize: 14, color: '#E0F2FE', opacity: 0.7 },                        <View style={styles.infoRow}>

    breadcrumbTextActive: { fontSize: 14, color: '#FFE157', fontWeight: '600' },                            <Ionicons name="checkmark-circle-outline" size={20} color="#6B7280" />

    profileSection: { alignItems: 'center', paddingVertical: 20, paddingHorizontal: 20, backgroundColor: '#132F3B' },                            <View style={styles.infoTextContainer}>

    profileImagePlaceholder: { width: 100, height: 100, borderRadius: 50, backgroundColor: '#0162B3', alignItems: 'center', justifyContent: 'center', marginBottom: 12 },                                <Text style={styles.infoLabel}>CHECK-OUT REALIZADO</Text>

    profileName: { fontSize: 22, fontWeight: 'bold', color: '#FFE157', textAlign: 'center', marginBottom: 4 },                                <Text style={styles.infoValue}>{formatDate(reserva.actual_check_out)}</Text>

    profileSubtitle: { fontSize: 18, color: '#E0F2FE', textAlign: 'center' },                            </View>

    subContainer: { flex: 1, width: '100%', backgroundColor: '#FFFFFF', borderTopLeftRadius: 20, borderTopRightRadius: 20, paddingVertical: 24, paddingHorizontal: 20, elevation: 4, shadowColor: '#000', shadowOffset: { width: 0, height: -2 }, shadowOpacity: 0.1, shadowRadius: 4, marginTop: 20 },                        </View>

    loadingText: { fontSize: 16, color: '#64748B', textAlign: 'center', marginTop: 12 },                    )}

    scrollContent: { flex: 1 },                </ScrollView>

    titleContainer: { marginBottom: 16 },                <View style={styles.titleSeparator} />

    title: { fontSize: 20, fontWeight: 'bold', color: '#1E293B' },

    separator: { width: '100%', height: 1, backgroundColor: '#E2E8F0', marginBottom: 20 },                {/* Botões de ação */}

    infoRow: { flexDirection: 'row', alignItems: 'flex-start', marginBottom: 20, paddingVertical: 8 },                <View style={styles.options}>

    infoTextContainer: { marginLeft: 12, flex: 1 },                    {/* Botões de Check-in/Check-out */}

    infoLabel: { fontSize: 16, color: '#64748B', fontWeight: '600', textTransform: 'uppercase', marginBottom: 4, letterSpacing: 0.5 },                    {reserva.status === 'Confirmada' && (

    infoValue: { fontSize: 18, color: '#1E293B', fontWeight: '500', lineHeight: 24 },                        <TouchableOpacity style={styles.buttonSuccess}>

    options: { width: '100%', gap: 12, paddingTop: 16, paddingBottom: 8 },                            <Ionicons name="log-in-outline" size={20} color="#FFFFFF" style={styles.buttonIcon} />

    buttonPrimary: { width: '100%', height: 48, backgroundColor: '#0162B3', borderRadius: 12, flexDirection: 'row', alignItems: 'center', justifyContent: 'center', elevation: 2, shadowColor: '#000', shadowOffset: { width: 0, height: 2 }, shadowOpacity: 0.15, shadowRadius: 3 },                            <Text style={styles.buttonSuccessText}>Confirmar Check-in</Text>

    buttonPrimaryText: { color: '#FFFFFF', fontSize: 16, fontWeight: '600' },                        </TouchableOpacity>

    buttonSuccess: { width: '100%', height: 48, backgroundColor: '#10B981', borderRadius: 12, flexDirection: 'row', alignItems: 'center', justifyContent: 'center', elevation: 2, shadowColor: '#000', shadowOffset: { width: 0, height: 2 }, shadowOpacity: 0.15, shadowRadius: 3 },                    )}

    buttonSuccessText: { color: '#FFFFFF', fontSize: 16, fontWeight: '600' },

    buttonWarning: { width: '100%', height: 48, backgroundColor: '#F59E0B', borderRadius: 12, flexDirection: 'row', alignItems: 'center', justifyContent: 'center', elevation: 2, shadowColor: '#000', shadowOffset: { width: 0, height: 2 }, shadowOpacity: 0.15, shadowRadius: 3 },                    {reserva.status === 'Ativa' && (

    buttonWarningText: { color: '#FFFFFF', fontSize: 16, fontWeight: '600' },                        <TouchableOpacity style={styles.buttonWarning}>

    buttonDanger: { width: '100%', height: 48, backgroundColor: 'transparent', borderRadius: 12, borderWidth: 1.5, borderColor: '#EF4444', flexDirection: 'row', alignItems: 'center', justifyContent: 'center' },                            <Ionicons name="log-out-outline" size={20} color="#FFFFFF" style={styles.buttonIcon} />

    buttonDangerText: { color: '#EF4444', fontSize: 16, fontWeight: '600' },                            <Text style={styles.buttonWarningText}>Confirmar Check-out</Text>

    buttonDisabled: { opacity: 0.5 },                        </TouchableOpacity>

    buttonIcon: { marginRight: 8 },                    )}

});

                    {/* ✅ REQUISITO 4: Botão editar com ID correto */}
                    <TouchableOpacity
                        style={styles.buttonPrimary}
                        onPress={() => router.push({
                            pathname: "/screens/Reserva/EdicaoReserva",
                            params: { id: reserva.id }
                        })}
                    >
                        <Ionicons name="create-outline" size={20} color="#FFFFFF" style={styles.buttonIcon} />
                        <Text style={styles.buttonPrimaryText}>Editar Reserva</Text>
                    </TouchableOpacity>

                    {/* ✅ REQUISITO 5: Modal de confirmação implementado */}
                    <TouchableOpacity style={styles.buttonDanger} onPress={handleDelete}>
                        <Ionicons name="trash-outline" size={20} color="#EF4444" style={styles.buttonIcon} />
                        <Text style={styles.buttonDangerText}>Excluir</Text>
                    </TouchableOpacity>
                </View>
            </View>
        </View>
    )
}


const styles = StyleSheet.create({
    container: {
        flex: 1,
        backgroundColor: '#132F3B',
    },
    header: {
        flexDirection: 'row',
        alignItems: 'center',
        paddingTop: 50,
        paddingBottom: 16,
        paddingHorizontal: 16,
        backgroundColor: '#132F3B',
    },
    backButton: {
        marginRight: 16,
    },
    breadcrumb: {
        flexDirection: 'row',
        alignItems: 'center',
        gap: 8,
        flex: 1,
    },
    breadcrumbText: {
        fontSize: 14,
        color: '#E0F2FE',
        opacity: 0.7,
    },
    breadcrumbTextActive: {
        fontSize: 14,
        color: '#FFE157',
        fontWeight: '600',
    },
    subContainer: {
        flex: 1,
        width: '100%',
        backgroundColor: '#FFFFFF',
        borderTopLeftRadius: 20,
        borderTopRightRadius: 20,
        paddingVertical: 24,
        paddingHorizontal: 20,
        elevation: 4,
        shadowColor: '#000',
        shadowOffset: { width: 0, height: -2 },
        shadowOpacity: 0.1,
        shadowRadius: 4,
        marginTop: 20,
    },
    scrollContent: {
        flex: 1,
    },
    reservaTitleContainer: {
        marginBottom: 24,
    },
    titleRow: {
        flexDirection: 'row',
        alignItems: 'center',
        justifyContent: 'space-between',
        marginBottom: 8,
    },
    reservaTitle: {
        fontSize: 30,
        fontWeight: 'bold',
        color: '#1E293B',
        flex: 1,
    },
    statusBadge: {
        paddingHorizontal: 12,
        paddingVertical: 6,
        borderRadius: 12,
        marginLeft: 12,
    },
    statusText: {
        color: '#FFFFFF',
        fontSize: 12,
        fontWeight: '600',
        textTransform: 'uppercase',
    },
    reservaSubtitle: {
        fontSize: 16,
        color: '#64748B',
        textTransform: 'uppercase',
    },
    titleSeparator: {
        width: '100%',
        height: 1,
        backgroundColor: '#E2E8F0',
        marginTop: 20,
    },
    separator: {
        width: '100%',
        height: 1,
        backgroundColor: '#E2E8F0',
        marginBottom: 20,
    },
    infoRow: {
        flexDirection: 'row',
        alignItems: 'flex-start',
        marginBottom: 20,
        paddingVertical: 8,
    },
    infoTextContainer: {
        marginLeft: 12,
        flex: 1,
    },
    infoLabel: {
        fontSize: 16,
        color: '#64748B',
        fontWeight: '600',
        textTransform: 'uppercase',
        marginBottom: 4,
        letterSpacing: 0.5,
    },
    infoValue: {
        fontSize: 18,
        color: '#1E293B',
        fontWeight: '500',
        lineHeight: 24,
    },
    options: {
        width: '100%',
        gap: 12,
        paddingTop: 16,
        paddingBottom: 8,
    },
    buttonSuccess: {
        width: '100%',
        height: 48,
        backgroundColor: '#10B981',
        borderRadius: 12,
        flexDirection: 'row',
        alignItems: 'center',
        justifyContent: 'center',
        elevation: 2,
        shadowColor: '#000',
        shadowOffset: { width: 0, height: 2 },
        shadowOpacity: 0.15,
        shadowRadius: 3,
    },
    buttonSuccessText: {
        color: '#FFFFFF',
        fontSize: 16,
        fontWeight: '600',
    },
    buttonWarning: {
        width: '100%',
        height: 48,
        backgroundColor: '#F59E0B',
        borderRadius: 12,
        flexDirection: 'row',
        alignItems: 'center',
        justifyContent: 'center',
        elevation: 2,
        shadowColor: '#000',
        shadowOffset: { width: 0, height: 2 },
        shadowOpacity: 0.15,
        shadowRadius: 3,
    },
    buttonWarningText: {
        color: '#FFFFFF',
        fontSize: 16,
        fontWeight: '600',
    },
    buttonPrimary: {
        width: '100%',
        height: 48,
        backgroundColor: '#0162B3',
        borderRadius: 12,
        flexDirection: 'row',
        alignItems: 'center',
        justifyContent: 'center',
        elevation: 2,
        shadowColor: '#000',
        shadowOffset: { width: 0, height: 2 },
        shadowOpacity: 0.15,
        shadowRadius: 3,
    },
    buttonPrimaryText: {
        color: '#FFFFFF',
        fontSize: 16,
        fontWeight: '600',
    },
    buttonDanger: {
        width: '100%',
        height: 48,
        backgroundColor: 'transparent',
        borderRadius: 12,
        borderWidth: 1.5,
        borderColor: '#EF4444',
        flexDirection: 'row',
        alignItems: 'center',
        justifyContent: 'center',
    },
    buttonDangerText: {
        color: '#EF4444',
        fontSize: 16,
        fontWeight: '600',
    },
    buttonIcon: {
        marginRight: 8,
    },
})


export default InfoReserva;
